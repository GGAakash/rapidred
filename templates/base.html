<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{% block title %}RapidRed{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- DARK THEME: central variables -->
  <style>
    :root{
      --bg: #0b1220;        /* page background */
      --surface: #0f1724;   /* navbar / panels */
      --card: #111827;      /* card background */
      --muted: #9ca3af;     /* secondary text */
      --text: #e6eef8;      /* main text */
      --accent: #ef4444;    /* brand red */
      --btn-bg: #ef4444;    /* primary button bg */
      --btn-text: #ffffff;  /* primary button text */
      --link: #ff6b6b;
      --badge-bg: #10b981;
      --shadow: rgba(0,0,0,0.6);
      --border-weak: rgba(255,255,255,0.04);
      --card-stripe: rgba(255,255,255,0.01);
    }

    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* navbar and cards */
    .navbar, .card { background: var(--surface) !important; color: var(--text); box-shadow: 0 2px 6px var(--shadow); }
    .card{ border: 0; }
    .lead, p, label, small { color: var(--muted); }

    /* links and accent */
    a, .nav-link { color: var(--link) !important; }
    a:hover, .nav-link:hover { color: #ff8b8b !important; }

    /* Primary buttons (RapidRed) */
    .btn-rapid, .btn-danger {
      background: linear-gradient(180deg, var(--btn-bg), #c33a3a) !important;
      color: var(--btn-text) !important;
      border: 1px solid rgba(0,0,0,0.4);
      box-shadow: 0 6px 14px rgba(0,0,0,0.55);
    }

    /* Clear, readable outline buttons */
    .btn-outline-light {
      color: var(--text) !important;
      background: transparent;
      border: 1px solid var(--border-weak) !important;
    }
    .btn-outline-light:hover {
      background: rgba(255,255,255,0.02);
      border-color: rgba(255,255,255,0.06) !important;
    }

    /* badges */
    .badge-success{ background: var(--badge-bg) !important; color: #fff; }
    .badge-secondary{ background: rgba(255,255,255,0.06) !important; color: var(--muted); }

    /* table contrast */
    .table-dark { background: transparent; color: var(--text); }
    .table-dark th, .table-dark td { border-top: 1px solid var(--border-weak); color: var(--text); }
    .table-striped > tbody > tr:nth-of-type(odd) { background-color: var(--card-stripe); }

    /* notifications pane */
    #notif-list { color: var(--text); }

    /* small responsive niceties */
    @media (max-width: 768px){
      .navbar .collapse { margin-top: 8px; }
    }

    /* ensure form controls are visible in dark mode */
    .form-control, .form-select, textarea {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border-weak);
      color: var(--text);
    }
    .form-control:focus, .form-select:focus, textarea:focus {
      box-shadow: 0 0 0 0.15rem rgba(239,68,68,0.12);
      border-color: rgba(239,68,68,0.6);
      outline: none;
    }

    /* small typography adjustments */
    h4, h5, h6 { color: var(--text); }
    .text-muted { color: var(--muted) !important; }

    /* navbar toggler */
    .navbar-toggler {
      border-color: rgba(255,255,255,0.06);
    }
    .navbar-brand img { filter: drop-shadow(0 2px 6px rgba(0,0,0,0.6)); }

    /* focus outlines for accessibility */
    a:focus, button:focus, input:focus {
      outline: 2px solid rgba(239,68,68,0.14);
      outline-offset: 2px;
    }
  </style>

  {% block head %}{% endblock %}
</head>
<body>
<nav class="navbar navbar-expand-lg" aria-label="Main navigation">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('index') }}" style="color:var(--text); font-weight:700;">
      <img src="{{ url_for('static', filename='favicon.ico') }}" alt="logo" style="width:28px; height:28px; margin-right:8px; vertical-align:middle;">
      RapidRed
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navMain">
      <ul class="navbar-nav me-auto">
        {% if session.get('user_role') == 'hospital' %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('request_blood') }}">New Request</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('hospital_requests') }}">My Requests</a></li>
        {% elif session.get('user_role') == 'admin' %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('admin_dashboard') }}">Admin</a></li>
        {% elif session.get('user_role') == 'donor' %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('donor_dashboard') }}">Dashboard</a></li>
        {% endif %}
      </ul>

      <div class="d-flex align-items-center gap-2">
        {% if session.get('user_role') %}
          <a class="btn btn-sm btn-outline-light" href="{{ url_for('logout') }}">Logout</a>
        {% else %}
          <a class="btn btn-sm btn-outline-light" href="{{ url_for('login') }}">Login</a>
        {% endif %}
      </div>
    </div>
  </div>
</nav>

<div class="container py-4">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for cat, msg in messages %}
        <div class="alert alert-{{ 'danger' if cat=='error' else 'info' }}">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="row">
    <div class="col-md-8">
      {% block content %}{% endblock %}
    </div>

    <div class="col-md-4">
      <div class="card p-2 mb-3">
        <h6 style="margin:0 0 6px 0;color:var(--text)">Notifications</h6>
        <div id="notif-list" style="max-height:420px;overflow:auto;">
          {% if notifications %}
            <ul class="list-unstyled" style="margin:0;padding:0;">
              {% for n in notifications %}
                <li class="mb-2" style="padding-bottom:6px;border-bottom:1px solid var(--border-weak);">
                  <small style="color:var(--muted)">{{ n.created_at.strftime('%Y-%m-%d %H:%M') if n.created_at else '' }}</small><br>
                  <span style="color:var(--text)">{{ n.payload }}</span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <div class="text-muted small">No notifications yet.</div>
          {% endif %}
        </div>
      </div>

      <div class="card p-2">
        <h6 style="margin:0 0 6px 0;color:var(--text)">Quick Help</h6>
        <small class="text-muted">Allow location in donor dashboard to receive live requests.</small>
      </div>
    </div>
  </div>
</div>

<!-- scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

{% block scripts %}{% endblock %}
</body>
</html>
