{% extends "base.html" %}
{% block title %}Matches / Results{% endblock %}
{% block content %}
<div class="card p-3">
  <h4>Matches for Request #{{ request_id }}</h4>

  <h6>Notified donors</h6>
  <table class="table table-dark">
    <thead><tr><th>Name</th><th>Phone</th><th>Distance (km)</th><th>Score</th><th>SMS</th></tr></thead>
    <tbody>
      {% for n in notified %}
        <tr>
          <td>{{ n.name }}</td>
          <td>{{ n.phone }}</td>
          <td>{{ n.distance_km }}</td>
          <td>{{ n.score }}</td>
          <td>{% if n.sms_sent %}Yes{% else %}No{% endif %}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <h6 class="mt-3">Top matches (map preview)</h6>
  <div id="map" style="height:320px;"></div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script>
  var map = L.map('map').setView([13.02,80.12], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  try {
    var matches = {{ matches|tojson }};
    matches.forEach(function(m){
      if(m.latitude && m.longitude){
        L.marker([m.latitude, m.longitude]).addTo(map).bindPopup(m.name + ' â€¢ ' + m.distance_km + ' km');
      }
    });
  } catch(e){}
</script>
{% endblock %}
